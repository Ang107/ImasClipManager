<Window x:Class="ImasClipManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ImasClipManager.ViewModels"
        Title="ImasClipManager" Height="1000" Width="1800" 
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <Button Content="＋ 新規追加" Padding="15,8" FontSize="14" Command="{Binding AddClipCommand}" Margin="0,0,20,0"/>
                <TextBox Width="300" 
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         VerticalContentAlignment="Center" FontSize="14"/>
                <TextBlock Text="🔍" VerticalAlignment="Center" Margin="-25,0,0,0" IsHitTestVisible="False" Foreground="Gray"/>
            </StackPanel>

            <DataGrid Grid.Row="1" 
                      ItemsSource="{Binding Clips}" 
                      AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal"
                      RowHeight="40"
                      MouseDoubleClick="DataGrid_MouseDoubleClick">

                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Tag" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>

                        <Setter Property="ContextMenu">
                            <Setter.Value>
                                <ContextMenu>
                                    <MenuItem Header="詳細を見る" 
                              Command="{Binding PlacementTarget.Tag.ShowClipDetailCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>

                                    <MenuItem Header="編集" 
                              Command="{Binding PlacementTarget.Tag.EditClipCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>

                                    <Separator/>

                                    <MenuItem Header="削除" 
                              Command="{Binding PlacementTarget.Tag.DeleteClipCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                              CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                              Foreground="Red"/>
                                </ContextMenu>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.Resources>
                    <Style TargetType="TextBlock" x:Key="EllipsisText">
                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                        <Setter Property="VerticalAlignment" Value="Center"/>
                    </Style>
                </DataGrid.Resources>

                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="サムネ" Width="0.8*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Image Source="{Binding ThumbnailPath}" Height="35" Stretch="Uniform" HorizontalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="曲名" Binding="{Binding SongTitle}" Width="1.5*" ElementStyle="{StaticResource EllipsisText}"/>
                    <DataGridTextColumn Header="公演名" Binding="{Binding ConcertName}" Width="1.5*" ElementStyle="{StaticResource EllipsisText}"/>
                    <DataGridTextColumn Header="公演日" Binding="{Binding ConcertDate, StringFormat=yyyy/MM/dd}" Width="0.8*" ElementStyle="{StaticResource EllipsisText}"/>
                    <DataGridTextColumn Header="形式" Binding="{Binding LiveType}" Width="0.6*" ElementStyle="{StaticResource EllipsisText}"/>
                    <DataGridTextColumn Header="ブランド" Binding="{Binding Brands}" Width="1.2*" ElementStyle="{StaticResource EllipsisText}"/>
                    <DataGridTextColumn Header="歌詞" Binding="{Binding Lyrics}" Width="2*" ElementStyle="{StaticResource EllipsisText}"/>
                    <DataGridTextColumn Header="備考" Binding="{Binding Remarks}" Width="1.5*" ElementStyle="{StaticResource EllipsisText}"/>
                    <DataGridTextColumn Header="再生数" Binding="{Binding PlayCount}" Width="0.5*" ElementStyle="{StaticResource EllipsisText}"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Window>